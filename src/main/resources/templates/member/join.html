<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name='generator' content='Schema'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" type="text/css" href="../../../plugin/jqGrid/jQuery.jqGrid.css" >
    <link rel="stylesheet" type="text/css" href="../../../plugin/jqGrid/ui.jqGrid.css" >
    <link rel="stylesheet" type="text/css" href="../../../css/style.css" >
    <link rel="stylesheet" type="text/css" href="../../../css/schema.css" >

    <link rel="stylesheet" type="text/css" href="../../../plugin/loading/iosOverlay.css" >
    <link rel="stylesheet" type="text/css" href="../../../plugin/sweetalert/sweetalert2.css" >

    <script type="text/javascript" src="../../../plugin/jquery/jquery-3.7.1.min.js"></script>
    <script type="text/javascript" src="../../../plugin/jqueryUi/jquery-ui.js"></script>
    <script type="text/javascript" src="../../../plugin/jqGrid/jquery.jqGrid.js"></script>
    <script type="text/javascript" src="../../../js/app.js"></script>

    <script type="text/javascript" src="../../../plugin/loading/iosOverlay.js"></script>
    <script type="text/javascript" src="../../../plugin/loading/spin.min.js"></script>
    <script type="text/javascript" src="../../../plugin/sweetalert/core.js"></script>
    <script type="text/javascript" src="../../../plugin/sweetalert/sweetalert2.min.js"></script>

    <script type="text/javascript" src="../../../js/pages/schema.common.js?v=20241122"></script>
    <script type="text/javascript" src="../../../js/pages/main.js"></script>

    <title data-langsid="회원가입"></title>
</head>
<body>
<!--==alert==-->
<div class="cui_dialog" style="width:420px;display:none" id="dialog">
    <div class="dialog_container">
        <div class="dialog_body">
            <div class="body_root">
                <div class="cui_alert alert_modal alert_basic" data-type="success" role="alert" id="alertTypeimg"> <p id="messageContent" ></p> </div>
                <div class="cui_items_wrap" data-direction="center">
                    <div class="item_content">
                        <button type="button" class="cui_button primary modal-close" onClick="modal_close('dialog')"><span data-langsid="확인"></span></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--==alert==-->
<div id="overlay" class="overlay"></div>
<div class="cui_app">
    <div class="cui_global">
        <h1 class="global_logo">
            <a href="#" onclick="goMenu('/main')"><span class="blind" data-langsid="동우화인캠"></span></a>
        </h1>
        <nav class="cui_gnb" role="navigation">
            <ul>
                <li class="more">
                    <a href="#" class="toggle"><span>더보기</span></a>
                    <ul></ul>
                </li>
            </ul>
        </nav>
        <div class="global_utility">
            <div class="utility_profile">
                <div class="info">
                    <strong data-langsid="안녕하세요."></strong>
                </div>
            </div>
            <button type="button" class="global_icon" data-cui-icon="logout" data-tooltip-title="Home"  onclick="goMenu('/logout')"><span>Home</span></button>
        </div>
    </div>
    <div class="cui_container center" data-module="join">
        <div class="cui_lnb">
            <div class="lnb_root">
                <div class="lnb_head">
                    <h2 class="lnb_title"><span data-langsid="회원가입"></span></h2>
                </div>
                <div class="cui_nav">
                    <nav class="nav_root">
                        <ul>
                            <li>
                                <a href="#" class="nav_item">
                                    <span class="nav_label" data-langsid="회원가입"></span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
        <div class="cui_content " data-module="join">
            <div class="cui_main">
                <div class="cui_head">
                    <div class="head_content">
                        <h2 class="cui_title center"><span data-langsid="회원가입"></span></h2>
                    </div>
                </div>
                <div class="cui_body">
                    <div class="cui_step">
                        <ol>
                            <li>
                                <i data-cui-icon="file_search"></i>
                                <span data-langsid="정보수집 동의"></span>
                            </li>
                            <li class="active">
                                <i data-cui-icon="lock"></i>
                                <span data-langsid="ID/PW 및 벤더정보"></span>
                            </li>
                            <li>
                                <i data-cui-icon="receipt"></i>
                                <span data-langsid="워런티 협약"></span>
                            </li>
                            <li>
                                <i data-cui-icon="task"></i>
                                <span data-langsid="동우 승인"></span>
                            </li>
                        </ol>
                    </div>
                    <form id="frmJoin" class="cui_form_section" data-legend="true" action="/member/warranty" method="post">
                        <fieldset>
                            <legend><span data-langsid="기본정보"></span></legend>
                            <table class="cui_table">
                                <colgroup>
                                    <col style="width:154px;">
                                    <col>
                                </colgroup>
                                <tbody>
                                <tr>
                                    <th><span data-langsid="Vendor 번호 및 사업자등록번호 검색"></span></th>
                                    <td>
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <select class="cui_select_field" id = "searchCustomerType">
                                                    <option value="VendorNum" data-langsid="Vendor 번호"></option>
                                                    <option value="BusinessNum" data-langsid="사업자등록 번호"></option>
                                                </select>
                                                <input name ="COM_CODE" autocomplete="off" class="cui_text_field" type="text"  id = "searchCustomer">
                                                <button type="button" class="cui_button icon" data-cui-icon="search" onclick ="vendorCheck()"><span data-langsid="검색"></span></button>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>

                                </tr>
                                <tr>
                                    <th><span data-langsid="귀사 정보"></span></th>
                                    <td>
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <input class="cui_text_field" type="text"  id="COM_NAME" disabled>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th><span data-langsid="Vendor 업종 형태"></span></th>
                                    <td>
                                        <div class="cui_items_wrap" data-wrap="wrap" data-direction="left">
                                            <div class="item_content">
                                                <label class="cui_checkbox"><input type="radio" name="VENDOR_WORK_KIND" value="D" id="Manufacturer" ><i></i><span data-langsid="제조사"></span></label>
                                                <label class="cui_checkbox"><input type="radio" name="VENDOR_WORK_KIND" value="L" id="Logistics"><i></i><span data-langsid="물류사"></span></label>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th><span data-langsid="국가"></span></th>
                                    <td>
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <input class="cui_text_field" type="text"  name="COM_NATION" id="COM_NATION" disabled>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <div class="cui_alert alert_basic" data-type="info" role="alert" id="firstCompany">
                                <div class="alert_message">
                                    <p data-langsid="최초등록 업체입니다."></p>
                                </div>
                            </div>
                            <div class="cui_alert alert_basic" data-type="info" role="alert" id="registeredCompany">
                                <div class="alert_message">
                                    <p data-langsid="기등록 업체입니다."></p>
                                </div>
                            </div>
                            <div class="cui_alert alert_basic" data-type="warning" role="alert" id="noCompanyCode">
                                <div class="alert_message">
                                    <p data-langsid="업체코드 내역이 없어 가입이 불가합니다."></p>
                                </div>
                            </div>
                            <div class="cui_alert alert_basic" data-type="info" role="alert" id="errCompanyCode">
                                <div class="alert_message">
                                    <p id=errCompanyCodeMsg></p>
                                </div>
                            </div>
                        </fieldset>

                        <div><br /></div>

                        <div id="joinBasicStep1">

                        <fieldset id="userInfoFieldset">
                            <legend><span data-langsid="공동 업무자 정보"></span></legend>

                            <table class="cui_table center">
                                <thead>
                                <tr>
                                    <th><span data-langsid="성명"></span></th>
                                    <th><span data-langsid="직위"></span></th>
                                    <th><span data-langsid="부서명"></span></th>
                                    <th><span data-langsid="email"></span></th>
                                    <th><span data-langsid="연락처"></span></th>
                                    <th><button type="button" class="cui_button secondary" id="addRowButton" ><span data-langsid="추가"></span></button></th>
                                </tr>
                                </thead>
                                <tbody id="tableBody">
                                <tr>
                                    <td><input type="text" class="cui_text_field" name="USER_NAME" data-langsid="이름" placeholder=""  onblur="setUserSelectReset()" reqcheck="reqcheck" data-messages="성명을 입력해 주세요" messages=""></td>
                                    <td><input type="text" class="cui_text_field" name="USER_POSITION" data-langsid="직위" onblur="setUserSelectReset()" reqcheck="reqcheck" data-messages="직위를 입력해 주세요" messages=""></td>
                                    <td><input type="text" class="cui_text_field" name="USER_DEPT"  data-langsid="부서" onblur="setUserSelectReset()" reqcheck="reqcheck" data-messages="부서명을 입력해 주세요" messages=""></td>
                                    <td><input type="email" class="cui_text_field" name="USER_EMAIL" data-langsid="이메일" placeholder="" id="USER_EMAIL"  onblur="setUserSelectReset()" reqcheck="reqcheck" data-messages="Email를 입력해 주세요" messages=""></td>
                                    <td><input type="text" class="cui_text_field" name="USER_PHONE" data-langsid="전화번호" placeholder=""  onblur="setUserSelectReset()" reqcheck="reqcheck" data-messages="연락처를 입력해 주세요" messages=""></td>
                                    <td></td>
                                </tr>
                                </tbody>
                            </table>
                        </fieldset>

                        <fieldset id="userInfoPWFieldset">
                            <legend><span>ID/PW</span></legend>
                            <table class="cui_table">
                                <colgroup>
                                    <col style="width:154px;">
                                    <col>
                                    <col style="width:154px;">
                                    <col>
                                </colgroup>
                                <tbody>
                                <tr>
                                    <th><span>ID</span></th>
                                    <td>
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <input class="cui_text_field" type="text" name = "USER_ID" id ="memberID" >
                                                <button type="button" class="cui_button icon" data-cui-icon="search" id="btnIdCheck"  onclick ="memberIDCheck()"><span data-langsid="중복검사"></span></button>
                                                <input type="hidden" name="ID_CHK" id="ID_CHK">
                                            </div>
                                        </div>
                                    </td>
                                    <th><span data-langsid="담당자"></span></th>
                                    <td>
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <select class="cui_select_field wide" name ="USERSELECT" id="userSelect" >
                                                    <option value="0" data-langsid="담당자 목록"></option>
                                                </select>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th><span>PW</span></th>
                                    <td>
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <input class="cui_text_field" type="password" autocomplete="off"  name ="USER_PWD" id="UserPass"  onkeyup="passConfirm()" reqcheck="reqcheck" data-messages="비밀번호를 입력해 주세요." data-langsid="비밀번호" messages="" >
                                            </div>
                                        </div>
                                    </td>
                                    <th><span data-langsid="PW 확인"></span></th>
                                    <td>
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <input class="cui_text_field" type="password" autocomplete="off" id="UserPassRe" onkeyup="passConfirm()" reqcheck="reqcheck" data-messages="비밀번호를 확인해 주세요." data-langsid="비밀번호 확인"  messages="">
                                                <input type="hidden" name="PW_CHK" id="PW_CHK" >
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr id="tr_id_pw_add_reason" >
                                    <th><span data-langsid="ID/PW 추가사유"></span></th>
                                    <td colspan="3">
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <input name="ID_PW_ADD_REASON" id="ID_PW_ADD_REASON" class="cui_text_field wide" type="text">
                                                <input type="hidden" name="ID_ADD_TYPE" id="ID_ADD_TYPE" value="0">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <div class="cui_alert alert_basic" data-type="warning" role="alert" id = "dupliCation">
                                <div class="alert_message">
                                    <p data-langsid="동일 사업부/공장에서 업무자별 ID 생성은 승인 불가 합니다."></p>
                                </div>
                            </div>
                            <div class="cui_alert alert_basic" data-type="warning" role="alert" id ="missPass">
                                <div class="alert_message">
                                    <p data-langsid="ID/PW 문의는 Main 담당자 또는 '공동업무자'에게 문의 바랍니다."></p>
                                </div>
                            </div>
                            <div class="cui_alert alert_basic" data-type="warning" role="alert" id ="selectOwner">
                                <div class="alert_message">
                                    <p style = "color: #E40087;" data-langsid="담당자를 선택해 주세요."></p>
                                </div>
                            </div>
                            <div class="cui_alert alert_basic" data-type="warning" role="alert" id ="IdVAL">
                                <div class="alert_message">
                                    <p><span id ="IdValidatorMsg"></span></p>
                                </div>
                            </div>
                            <div class="cui_alert alert_basic" data-type="warning" role="alert" id ="PassVAL">
                                <div class="alert_message">
                                    <p><span id ="confirmMsg"></span></p>
                                </div>
                            </div>
                        </fieldset>

                        <fieldset>
                            <legend><span data-langsid="업체정보"></span></legend>
                            <table class="cui_table">
                                <colgroup>
                                    <col style="width:154px;">
                                    <col>
                                    <col style="width:154px;">
                                    <col>
                                </colgroup>
                                <tbody>
                                <tr>
                                    <th><span data-langsid="회사명"></span></th>
                                    <td>
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <input class="cui_text_field" type="text" name = "COMPANY_NAME" id="COMPANY_NAME">
                                            </div>
                                        </div>
                                    </td>
                                    <th><span data-langsid="제조 공장명"></span></th>
                                    <td>
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <input class="cui_text_field" type="text" name = "FACTORY_NAME" id="FACTORY_NAME">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th><span data-langsid="사업자 등록번호"></span></th>
                                    <td>
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <input class="cui_text_field" type="text"  name = "BUS_NUMBER" id="BUS_NUMBER">
                                            </div>
                                        </div>
                                    </td>
                                    <th><span data-langsid="회사주소"></span></th>
                                    <td>
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <input class="cui_text_field" type="text"  name = "COM_ADDRESS" id="COM_ADDRESS">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th><span data-langsid="CEO 성명"></span></th>
                                    <td>
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <input class="cui_text_field" type="text"  name = "COM_CEO_NAME" id="COM_CEO_NAME">
                                            </div>
                                        </div>
                                    </td>
                                    <th><span data-langsid="CEO 연락처"></span></th>
                                    <td>
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <input class="cui_text_field" type="text" name = "COM_CEO_PHONE" id="COM_CEO_PHONE">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th><span data-langsid="CEO e-mail"></span></th>
                                    <td colspan="3">
                                        <div class="cui_items_wrap" data-direction="left">
                                            <div class="item_content">
                                                <input class="cui_text_field" type="text" name ="COM_CEO_EMAIL" id ="COM_CEO_EMAIL">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th><span data-langsid="접속 목적"></span></th>
                                    <td colspan="3">
                                        <div class="cui_items_wrap" data-direction="column">
                                            <div class="item_content">
                                                <div id="divGoal" class="item_content wrap" style="display: flex; flex-wrap: wrap;" >
                                                    <label class="cui_checkbox wide"><input type="checkbox" name="checkbox1"><i></i><span>Audit Management (노동환경)</span></label>
                                                </div>
                                                <!-- JSON 데이터를 저장할 숨겨진 필드 -->
                                                <input type="hidden" name="checkboxDataJson" id="checkboxDataJson">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </fieldset>

                        <div class="cui_items_wrap" data-direction="right" >
                            <div class="item_content">
                                <a href="#" onclick="return chk_form()" class="cui_button primary"><span data-langsid="다음"></span></a>
                            </div>
                        </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script>

    const goMenu = (menuPage) => {
        location.href = menuPage;
    }

    $(document).ready(function() {

         hideCompanyStatusInfo();
         hideMemberInfo();
         $('#searchCustomer').focus();
         $('#joinBasicStep1').hide();

         $('#addRowButton').on('click', function() {
            const newRow = `
                <tr>
                    <td><input type="text" class="cui_text_field" id="user_name" name="USER_NAME" placeholder="이름"  onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="성명을 입력해 주세요" messages=""></td>
                    <td><input type="text" class="cui_text_field" id="user_position" name="USER_POSITION"  placeholder="직위" onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="직위를 입력해 주세요" messages=""></td>
                    <td><input type="text" class="cui_text_field" id="user_dept" name="USER_DEPT"  placeholder="부서명" onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="부서명을 입력해 주세요" messages=""></td>
                    <td><input type="email" class="cui_text_field" id="user_email" name="USER_EMAIL" placeholder="이메일"  onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="Email를 입력해 주세요" messages=""></td>
                    <td><input type="text" class="cui_text_field" id="user_phone" name="USER_PHONE" placeholder="전화번호"  onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="연락처를 입력해 주세요" messages=""></td>
                    <td><button type="button" class="cui_button icon" data-cui-icon="trash" id="delRowButton"><span data-langsid="삭제"></span></button></td>
                </tr>
            `;

            $('#tableBody').append(newRow);
            setUserSelectReset();
            siteLang.showLangs();
        });

        // 공동 업무자 정보 삭제
        $(document).on('click', '#delRowButton', function() {
            $(this).closest('tr').remove();
            setUserSelectReset() ;
        });

        let elInputUSER_NAME = document.querySelector('#memberID');

        //ID /PASS 유효성
        elInputUSER_NAME.onkeyup = function (event) {

        if (event.key === 'Enter' || event.keyCode === 13) {
           return;
        }

         var correctColor = "#18AD72";
         var wrongColor = "#E40087" ;

          IdValidatorMsg.style.color = wrongColor;
          $('#ID_CHK').val("");

          // 값을 입력한 경우
          if (elInputUSER_NAME.value.length !== 0) {
            // 영어 또는 숫자 외의 값을 입력했을 경우
            if(onlyNumberAndEnglish(elInputUSER_NAME.value) === false) {
                $('#IdVAL').show();
                IdValidatorMsg.innerHTML = siteLang.getLang("영어 또는 숫자만 가능합니다.") ;
            }
            // 글자 수가 4~12글자가 아닐 경우
            else if(idLength(elInputUSER_NAME.value) === false) {
                $('#IdVAL').show();
                IdValidatorMsg.innerHTML =  siteLang.getLang("아이디는 6~12글자이어야 합니다.") ;
            }
            // 조건을 모두 만족할 경우
            else if(idLength(elInputUSER_NAME.value) || onlyNumberAndEnglish(elInputUSER_NAME.value)) {

               $('#IdVAL').show();
               IdValidatorMsg.style.color = correctColor;
               IdValidatorMsg.innerHTML = siteLang.getLang("사용할 수 있는 아이디입니다.[중복 체크를 해 주세요]") ;
               $('#ID_CHK').val("ready");
            }
          }
          // 값을 입력하지 않은 경우 (지웠을 때)
          else {
               $('#IdVAL').show();
               IdValidatorMsg.innerHTML = siteLang.getLang("아이디는 6~12글자이어야 합니다.") ;
          }
        }
    });


    function setUserSelect(users) {
        var userSelect = document.getElementById('userSelect');
        users.forEach(function(user) {
            var option = document.createElement('option');
            option.value = user.name;
            option.textContent = user.name;
            userSelect.appendChild(option);
        });
    }

    //담당자 리셋
    function setUserSelectReset() {

        $("#userSelect option").each(function() {
            if ($(this).val() !== '0') {
                $(this).remove();
            }
        });

       var userList = extractData() ;
       setUserSelect(userList);

       $('#selectOwner').show();
    }

    // 공동 업무자 정보 데이터 추출
    function extractData() {

        var rows = document.querySelectorAll('#tableBody tr');
        var userList = [];

        rows.forEach(function(row) {
            var userData = {};
            var name = row.querySelector('input[name="USER_NAME"]').value;
            var email = row.querySelector('input[name="USER_EMAIL"]').value;

            userData.name = name;
            userData.email = email;

            userList.push(userData);
        });

        return userList;
    }


    //밴더 사업자 검색후 표기 초기화
    function hideCompanyStatusInfo () {
      $('#ID_CHK').val("");
      $('#PW_CHK').val("");
      $('#firstCompany').hide();
      $('#tr_id_pw_add_reason').hide();
      $('#registeredCompany').hide();
      $('#noCompanyCode').hide();
      $('#errCompanyCode').hide();
    }

    function hideMemberInfo () {
      $('#IdVAL').hide();
      $('#dupliCation').hide();
      $('#missPass').hide();
    }


    // 기본 정보 조회 Vendor 번호,사업자 등록번호 체크
    const vendorCheck = () => {
    const searchType = document.getElementById("searchCustomerType").value;
    const searchCustomer = document.getElementById("searchCustomer").value;

      hideCompanyStatusInfo();

      if (!searchCustomer) {
         $('#searchCustomer').focus();
         if(searchType == "VendorNum"){
              Common.Msg(siteLang.getLang("Vendor 번호를 입력해주세요."));
         } else{
              Common.Msg(siteLang.getLang("사업자등록번호를 입력해주세요."));
         }
        return;
      }

      if(searchType == "VendorNum"){
            document.getElementById('BUS_NUMBER').readOnly = false;
      } else{
            document.getElementById('BUS_NUMBER').readOnly = true;
      }

      var sUrl = "/member/vendor-check" ;
      $.ajax({
          type: "post",
          url:   sUrl,
          data: {
              "searchCode": searchCustomer
              ,"searchType" : searchType
          },
          success: function(res) {

              if (res.status == "exgist") {
               //기등록
               $('#registeredCompany').show();
               $('#tr_id_pw_add_reason').show();
               $('#joinBasicStep1').show();

                bindCompanyInfo(res);
                bindMemberGoalList(res.memberGoalList);
                unbindCompanyUserInfo();
                document.getElementById("ID_ADD_TYPE").value = "1" ;
                setFieldsReadOnly(false);

              } else if (res.status == "notcpcode") {
                //cp 코드 없음.
                $('#noCompanyCode').show();
                $('#joinBasicStep1').hide();

                document.getElementById('Logistics').checked = false;
                document.getElementById('Manufacturer').checked = false;
                document.getElementById("COM_NAME").value = "" ;
                document.getElementById("COM_NATION").value = "";
                unbindCompanyUserInfo();

              } else if (res.status == "new") {
                //신규.
                $('#firstCompany').show();
                $('#joinBasicStep1').show();
                bindCompanyInfo(res);
                bindCompanyUserList(res.companyUserList);
                bindMemberGoalList(res.memberGoalList);
                unbindCompanyUserInfo();
                setFieldsReadOnly(false);

              }else {
                //가입 진행중.
                $('#errCompanyCode').show();
                $('#joinBasicStep1').show();
                bindCompanyInfo(res);
                bindCompanyUserInfo(res);
                bindMemberGoalList(res.memberGoalList);

                if(res.companyUserList != "undefined"){
                    bindCompanyUserList(res.companyUserList);
                }
                setFieldsReadOnly(true);

                var statusM = siteLang.getLang(res.status);
                var statusMsg = siteLang.getLang("중인 정보가 있습니다. 관리자에게 문의하세요") ;
                errCompanyCodeMsg.innerHTML = "["+ statusM + "] " + statusMsg ;

              }
          },
          error: function(err) {
              console.log("에러발생", err);
          }
      });
    }

    //가입신청 된거 있을때 공동 업무자 정보 바인딩
    function bindCompanyUserList(companyUserList) {
       const tableBody = document.getElementById("tableBody");
        tableBody.innerHTML = '';

        if (companyUserList === undefined || companyUserList.length === 0) {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td><input type="text" class="cui_text_field"  id="user_name" name="USER_NAME" placeholder="이름" onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="성명을 입력해 주세요" messages=""></td>
                <td><input type="text" class="cui_text_field"  id="user_position" name="USER_POSITION" placeholder="직위" onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="직위를 입력해 주세요" messages=""></td>
                <td><input type="text" class="cui_text_field"  id="user_dept" name="USER_DEPT" placeholder="부서명" onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="부서명을 입력해 주세요" messages=""></td>
                <td><input type="email" class="cui_text_field" id="user_email" name="USER_EMAIL" placeholder="이메일" onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="Email를 입력해 주세요" messages=""></td>
                <td><input type="text" class="cui_text_field"  id="user_phone" name="USER_PHONE" placeholder="전화번호" onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="연락처를 입력해 주세요" messages=""></td>
                <td></td>
            `;
            tableBody.appendChild(row);
        } else {

            companyUserList.forEach((item, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td><input type="text" class="cui_text_field" id="user_name" name="USER_NAME" value="${item.USER_NAME}" placeholder="이름" onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="성명을 입력해 주세요" messages=""></td>
                    <td><input type="text" class="cui_text_field" id="user_position" name="USER_POSITION" value="${item.USER_POSITION}" placeholder="직위" onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="직위를 입력해 주세요" messages=""></td>
                    <td><input type="text" class="cui_text_field" id="user_dept" name="USER_DEPT" value="${item.USER_DEPT}" placeholder="부서명" onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="부서명을 입력해 주세요" messages=""></td>
                    <td><input type="email" class="cui_text_field" id="user_email" name="USER_EMAIL" value="${item.USER_EMAIL}" placeholder="이메일" onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="Email를 입력해 주세요" messages=""></td>
                    <td><input type="text" class="cui_text_field" id="user_phone" name="USER_PHONE" value="${item.USER_PHONE}" placeholder="전화번호" onclick="setUserSelectReset()" reqcheck="reqcheck" data-messages="연락처를 입력해 주세요" messages=""></td>
                    <td>${index === 0 ? '' : '<button type="button" class="cui_button icon" data-cui-icon="trash" id="delRowButton"><span data-langsid="삭제"></span></button>'}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        siteLang.showLangs();
    }



    //기본정보 바인딩
    function bindCompanyInfo(companyInfo) {

        if (companyInfo) {
            document.getElementById("COM_NAME").value = companyInfo.COM_NAME ;

            // (D:제조사, L:물류사)
            var  selectedOption = companyInfo.VENDOR_WORK_KIND ;
            if (selectedOption === "D") {
              document.getElementById('Manufacturer').checked = true;
              document.getElementById('Logistics').checked = false;
            } else if (selectedOption === "L") {
              document.getElementById('Manufacturer').checked = false;
              document.getElementById('Logistics').checked = true;

            }else{
              document.getElementById('Logistics').checked = false;
              document.getElementById('Manufacturer').checked = false;
            }
            document.getElementById("COM_NATION").value =  companyInfo.COM_NATION;
            document.getElementById("COMPANY_NAME").value =  companyInfo.COMPANY_NAME;
            document.getElementById("FACTORY_NAME").value =  companyInfo.FACTORY_NAME;
            document.getElementById("BUS_NUMBER").value =  companyInfo.BUS_NUMBER;
            document.getElementById("COM_ADDRESS").value =  companyInfo.COM_ADDRESS;
            document.getElementById("COM_CEO_NAME").value =  companyInfo.COM_CEO_NAME;
            document.getElementById("COM_CEO_PHONE").value =  companyInfo.COM_CEO_PHONE;
            document.getElementById("COM_CEO_EMAIL").value =  companyInfo.COM_CEO_EMAIL;
        }
    }

    //공동사용자 기본정보 바인딩
    function bindCompanyUserInfo(companyInfo) {

        if (companyInfo) {
            //ID
            //$("#userSelect option").remove();
            //$("#userSelect").append("<option value='0'></option>");

            $("#userSelect option").each(function() {
                if ($(this).val() !== '0') {
                    $(this).remove();
                }
            });

            document.getElementById("memberID").value =  companyInfo.USER_ID;
            //document.getElementById("userSelect").value =  companyInfo.USER_NAME;
            var select = document.getElementById("userSelect");
            var option = document.createElement("option");
            option.value =companyInfo.USER_NAME;
            option.text = companyInfo.USER_NAME;
            select.appendChild(option);
            option.selected = true;

            companyInfo.companyUserList.forEach((item) => {
				if(item != null && item.USER_NAME != companyInfo.USER_NAME ){
				 var optionAdd = document.createElement("option");
					optionAdd.value = item.USER_NAME;
					optionAdd.text  = item.USER_NAME;
					select.appendChild(optionAdd);
				}
            });

            document.getElementById("ID_PW_ADD_REASON").value =  companyInfo.ID_PW_ADD_REASON;
            document.getElementById("ID_ADD_TYPE").value =  companyInfo.ID_ADD_TYPE;
            const idAddType = companyInfo.ID_ADD_TYPE;
            if(idAddType == "1") { // 0 :신규 사용자., 1:추가 사용자
                $('#tr_id_pw_add_reason').show();
            }

            //유효성
            $('#IdVAL').show();
            $('#selectOwner').hide();

            IdValidatorMsg.style.color = "#18AD72";
            IdValidatorMsg.innerHTML =  siteLang.getLang("사용할 수 있는 아이디입니다.") ;
            $('#ID_CHK').val("OK");
            passConfirm();
        }
    }

    //접속목적 바인딩
    function bindMemberGoalList(memberGoalList) {

        const divGoal = $('#divGoal');

        divGoal.empty();

        memberGoalList.forEach(function(memberGoal) {

            const checkbox = $('<input>', {
                type: 'checkbox',
                id: memberGoal.base_CODE,
                name: memberGoal.base_CODE,
                checked: memberGoal.user_ID !== null
            });

            const label = $('<label>', { class: 'cui_checkbox wide' });
            label.append(checkbox);
            label.append('<i></i>');
            label.append($('<span>').text(memberGoal.base_NAME));

            divGoal.append(label);
        });
    }

    //바인딩 초기화
    function unbindCompanyUserInfo() {

        //ID
        document.getElementById("memberID").value = "";
        setUserSelectReset();

        document.getElementById("UserPass").value =  "";
        document.getElementById("UserPassRe").value =  "";
        document.getElementById("ID_PW_ADD_REASON").value = "";

        //유효성
        $('#selectOwner').show(); //담당자선택 메세지
        passConfirm();
        document.querySelector('#memberID').onkeyup(event);

    }


    // member ID 체크
    const memberIDCheck = () => {

    const searchID = document.getElementById("memberID").value;
    const message = document.getElementById('IdValidatorMsg').innerHTML;

    if($('#ID_CHK').val() != "ready" ){
        return;
    }

      $.ajax({

          type: "post",
          url:  "/member/id-check",
          data: {
              "memberID": searchID
          },
          success: function(res) {

              hideMemberInfo();
              $('#IdVAL').show();

              if (res == "ok") {
                document.getElementById('IdValidatorMsg').innerHTML = siteLang.getLang("사용할 수 있는 아이디입니다.") ;
                $('#ID_CHK').val("OK");
              } else {
               IdValidatorMsg.style.color = "#E40087";
               document.getElementById('IdValidatorMsg').innerHTML = siteLang.getLang("동일한 아이디가 존재합니다.") ;
               $('#ID_CHK').val("");
              }
          },
          error: function(err) {
              console.log("에러발생", err);
          }
      });
    }

    // 이메일
    const emailCheck = () => {
      const email = document.getElementById("USER_EMAIL").value;
      const checkResult = document.getElementById("check-result");
      $.ajax({
          type: "post",
          url: "/member/email-check",
          data: {
              "USER_EMAIL": email
          },
          success: function(res) {

              if (res == "ok") {
                  checkResult.style.color = "green";
                  checkResult.innerHTML = siteLang.getLang("사용가능한 이메일") ;
              } else {
                  checkResult.style.color = "red";
                  checkResult.innerHTML = siteLang.getLang("이미 사용중인 이메일") ;
              }
          },
          error: function(err) {
              console.log("에러발생", err);
          }
      });
    }

    document.getElementById('searchCustomer').addEventListener('keydown', function(event) {
        if (event.key === 'Enter' || event.keyCode === 13) {
            vendorCheck();
        }
    });

    document.getElementById('memberID').addEventListener('keydown', function(event) {
        if (event.key === 'Enter' || event.keyCode === 13) {
            memberIDCheck();
        }
    });

    document.getElementById('userSelect').addEventListener('change', function() {
        const selectedValue = this.value;
        if (selectedValue == "0") {
            $('#selectOwner').show();
        } else {
         $('#selectOwner').hide();
        }
    });

    function setFieldsReadOnly(bool) {

        var fieldset = document.getElementById('userInfoFieldset');

        var inputs = fieldset.querySelectorAll('input[type="text"],input[type="email"]');
        var buttons = fieldset.querySelectorAll('button[type="button"]');

        inputs.forEach(function(input) {
            input.readOnly = bool;
        });

        buttons.forEach(function(button) {
            button.disabled = bool;
        });

        //ID

        var button = document.getElementById('btnIdCheck');
        button.disabled = bool;

        var input = document.getElementById('memberID');
        input.readOnly = bool;

        var userselect = document.getElementById('userSelect');
        userselect.readOnly = bool;

    }

    // Member / Pass 가입 ///////////////////

    <!--1. 회원가입 항목 조건-->
    <!--아이디 : 4~12글자, 영어나 숫자만 가능하다.-->
    <!--비밀번호 : 8글자 이상, 영문, 숫자, 특수문자를 모두 사용해야 한다.-->
    <!--비밀번호 확인 : 비밀번호와 일치해야 한다.-->

    //2-1. 아이디 : 글자 수 제한 (6글자 이상, 12글자 이하)
    function idLength(value) {
      return value.length >= 6 && value.length <= 12
    }

    //2-2. 아이디 : 영어 또는 숫자만 가능
    function onlyNumberAndEnglish(str) {
      return /^[A-Za-z0-9][A-Za-z0-9]*$/.test(str);
    }

    //2-3.Pass 유효성  , 비교
	function passConfirm() {
        var UserPass = document.getElementById('UserPass');
        var UserPassRe = document.getElementById('UserPassRe');
        var confirmMsg = document.getElementById('confirmMsg');
        var correctColor = "#18AD72";
        var wrongColor = "#E40087" ;

        // 정규식: 6자리 이상 숫자와 영문 (대문자 또는 소문자) 포함
        const regex = /^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]{6,}$/;

        if (regex.test(UserPass.value)) {
            confirmMsg.style.color = correctColor;
            //confirmMsg.innerHTML =  siteLang.getLang("비밀번호가 유효합니다.") ;

            if (UserPass.value === UserPassRe.value) {
                confirmMsg.style.color = correctColor;
                confirmMsg.innerHTML = siteLang.getLang("비밀번호가 일치합니다.") ;
                $('#PW_CHK').val("OK");
            } else {
                confirmMsg.style.color = wrongColor;
                confirmMsg.innerHTML = siteLang.getLang("비밀번호가 일치하지 않습니다.") ;
                $('#PW_CHK').val("");
            }

        } else {
            confirmMsg.style.color = wrongColor;
            confirmMsg.innerHTML = siteLang.getLang("비밀번호는 6자리 이상의 숫자와 영문자로만 구성되어야 합니다.") ;
            $('#PW_CHK').val("");
        }
    }

    //submit 전 체크
    function chk_form() {

        const checkedValue = $('input[name="VENDOR_WORK_KIND"]:checked').val();
        var radios = document.getElementsByName('VENDOR_WORK_KIND');
        if (checkedValue == undefined) {
            Common.Msg(siteLang.getLang("Vendor 업종 형태를 선택해 주세요."));
            radios[0].focus();
            return;
        }

        //공동사용자
        if (Common.Validate($("#userInfoFieldset")) != true) {
          return;
        }

        const message = document.getElementById('IdValidatorMsg').innerHTML;
        if($('#ID_CHK').val() != "OK"){
            Common.Msg(siteLang.getLang("아이디를 확인해 주십시오."));
            $('#memberID').focus();
            return;
        }

        const selectedValue = document.getElementById('userSelect').value;
        if (selectedValue == "0") {
            $('#selectOwner').focus();
             Common.Msg(siteLang.getLang("담당자를 선택해 주세요."));
            return;
        }

        if (selectedValue == "" ) {
            $('#selectOwner').focus();
            Common.Msg(siteLang.getLang("공동 업무자 정보를 확인해주세요. 기본 1인은 필수 입니다."));

            return;
        }

        if (Common.Validate($("#userInfoPWFieldset")) != true) {
          return;
        }

        if($('#PW_CHK').val() != "OK"){
            $('#UserPass').focus();
            Common.Msg(siteLang.getLang("비밀번호를 확인해 주십시오."));
            return;
        }

        //기등록 업체 일때... 아이디 추가 일때만 체크
        const reason = document.getElementById('ID_PW_ADD_REASON').value;
        if ($('#registeredCompany').is(':visible')) {
            if (reason == "") {
                $('#ID_PW_ADD_REASON').focus();
                Common.Msg(siteLang.getLang("ID/PW 추가사유를 입력해 주세요."));
                return;
            }
        }

        //접속목적
        const selectedGoals = [];
        $('#divGoal input[type="checkbox"]').each(function() {
            const isChecked = $(this).is(':checked');

            selectedGoals.push({
                id: $(this).attr("id"),
                checked: isChecked
            });
        });

        const jsonData = JSON.stringify(selectedGoals);
        $('#checkboxDataJson').val(jsonData);

        document.getElementById('frmJoin').submit();
    }

</script>
</html>